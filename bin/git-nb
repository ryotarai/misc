#!/bin/bash
set -e
if [[ -z "$1" ]]; then
	echo "Usage: $0 BRANCH_NAME" >&2
	exit 1
fi

DEFAULT_BRANCH="$(git remote show origin | sed -n '/HEAD branch/s/.*: //p')"
set -x
if [[ "$(git rev-parse --abbrev-ref HEAD)" = "$DEFAULT_BRANCH" ]]; then
	git pull origin "$DEFAULT_BRANCH"
else
	git fetch origin $DEFAULT_BRANCH:$DEFAULT_BRANCH
fi
GIT_STASH_OUTPUT="$(git stash)"
git checkout -b ryotarai/$1 "$DEFAULT_BRANCH"
if [[ "$GIT_STASH_OUTPUT" != "No local changes to save" ]]; then
	git stash pop
fi
